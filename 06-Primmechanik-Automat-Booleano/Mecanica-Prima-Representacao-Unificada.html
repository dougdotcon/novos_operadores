<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primmechanik - Vereinte Darstellung</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            color: #94a3b8;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .view-toggle {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .view-btn {
            padding: 12px 24px;
            border: 2px solid rgba(96, 165, 250, 0.3);
            background: rgba(30, 41, 59, 0.6);
            color: #94a3b8;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .view-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            border-color: transparent;
        }
        
        .view-btn:hover {
            transform: translateY(-2px);
        }
        
        .card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }
        
        .dual-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        
        @media (max-width: 1200px) {
            .dual-view {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(100, 116, 139, 0.2);
        }
        
        .panel-title {
            font-size: 1.25rem;
            color: #60a5fa;
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        canvas {
            width: 100%;
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.6);
        }
        
        .controls {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        label {
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        input[type="number"] {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(100, 116, 139, 0.4);
            color: #e2e8f0;
            padding: 8px 12px;
            border-radius: 6px;
            width: 100px;
        }
        
        button {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
        
        .state-display {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
        }
        
        .delta-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin: 8px 0;
            background: rgba(30, 41, 59, 0.6);
            border-left: 3px solid #3b82f6;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .prime-marker {
            background: rgba(139, 92, 246, 0.3);
            border: 2px solid #8b5cf6;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: bold;
        }
        
        .impulse {
            background: rgba(251, 146, 60, 0.3);
            border: 2px solid #fb923c;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: bold;
        }
        
        .formula-box {
            background: rgba(15, 23, 42, 0.8);
            border-left: 4px solid #8b5cf6;
            padding: 16px;
            margin: 12px 0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
        }
        
        .integration-map {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
        }
        
        .map-item {
            text-align: center;
            padding: 16px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
        }
        
        .map-arrow {
            color: #8b5cf6;
            font-size: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        
        .stat-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(96, 165, 250, 0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #60a5fa;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Primmechanik: Boolesche Logik ‚ü∑ Raumzeitliche Spirale</h1>
        <div class="subtitle">
            Integration von diskretem Œî-Operator und kontinuierlicher Primzeit-Transformation
        </div>

        <div class="view-toggle">
            <button class="view-btn active" onclick="setView('integrated')">
                üîó Integrierte Ansicht
            </button>
            <button class="view-btn" onclick="setView('boolean')">
                ‚ö° Boolesche Mechanik
            </button>
            <button class="view-btn" onclick="setView('geometric')">
                üåÄ Geometrische Spirale
            </button>
        </div>

        <!-- Steuerung -->
        <div class="card">
            <div class="controls">
                <div class="control-group">
                    <label>Start n‚ÇÄ</label>
                    <input type="number" id="startN" value="150" min="2">
                </div>
                <div class="control-group">
                    <label>Schritte</label>
                    <input type="number" id="steps" value="10" min="1" max="20">
                </div>
                <div class="control-group">
                    <label>Radius r</label>
                    <input type="number" id="radius" value="3" min="1" max="8" step="0.5">
                </div>
                <div class="control-group">
                    <label>Wicklung œâ</label>
                    <input type="number" id="omega" value="0.5" min="0.1" max="2" step="0.1">
                </div>
                <button onclick="calculate()">üîÑ Berechnen</button>
                <button onclick="startAnimation()">‚ñ∂Ô∏è Animation</button>
            </div>
        </div>

        <!-- Integrationsdiagramm -->
        <div class="card" id="integrationCard">
            <h3 style="color: #8b5cf6; margin-bottom: 16px;">
                Systemintegration: Diskret ‚ü∑ Kontinuierlich
            </h3>
            <div class="integration-map">
                <div class="map-item">
                    <div style="color: #60a5fa; font-weight: 600; margin-bottom: 8px;">
                        Œî-Operator (diskret)
                    </div>
                    <div class="formula-box" style="font-size: 0.85rem;">
                        Œî‚Çñ = min{d‚â•2: gcd(n‚Çñ+d, n‚Çñ)=1}<br>
                        n‚Çñ‚Çä‚ÇÅ = n‚Çñ + Œî‚Çñ<br>
                        Œ¥(n) = f(n+1) ‚äï f(n)
                    </div>
                </div>
                <div class="map-arrow">‚ü∑</div>
                <div class="map-item">
                    <div style="color: #8b5cf6; font-weight: 600; margin-bottom: 8px;">
                        Primzeit (kontinuierlich)
                    </div>
                    <div class="formula-box" style="font-size: 0.85rem;">
                        t‚Çñ = Œ£ ln(p‚±º)<br>
                        Œì(t) = (r¬∑cos(œât), r¬∑sin(œât), Œ∫t)<br>
                        p‚Çñ = exp(Œît‚Çñ)
                    </div>
                </div>
            </div>
        </div>

        <!-- Dual View -->
        <div id="mainView">
            <div class="dual-view">
                <!-- Boolesche Ansicht -->
                <div class="panel">
                    <div class="panel-title">‚ö° Œî-Operator & XOR-Impulse</div>
                    <div id="booleanSteps"></div>
                    <canvas id="booleanCanvas" width="600" height="400"></canvas>
                </div>

                <!-- Geometrische Ansicht -->
                <div class="panel">
                    <div class="panel-title">üåÄ Primspirale im Raum</div>
                    <div class="stats-grid" id="geometricStats"></div>
                    <canvas id="helixCanvas" width="600" height="400"></canvas>
                </div>
            </div>
        </div>

        <!-- Datenausgabe -->
        <div class="card">
            <h3 style="color: #60a5fa; margin-bottom: 16px;">
                Berechnete Sequenz
            </h3>
            <div id="sequenceOutput"></div>
        </div>
    </div>

    <script>
        let currentView = 'integrated';
        let animationId = null;
        let rotationY = 0;

        function setView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            calculate();
        }

        function isPrime(n) {
            if (n < 2) return false;
            if (n === 2) return true;
            if (n % 2 === 0) return false;
            for (let i = 3; i <= Math.sqrt(n); i += 2) {
                if (n % i === 0) return false;
            }
            return true;
        }

        function gcd(a, b) {
            while (b !== 0) {
                let t = b;
                b = a % b;
                a = t;
            }
            return a;
        }

        function findDelta(n) {
            for (let d = 2; d < 1000; d++) {
                if (gcd(n + d, n) === 1) {
                    return d;
                }
            }
            return 1;
        }

        function calculateSequence(start, steps) {
            const sequence = [{
                n: start,
                delta: 0,
                isPrime: isPrime(start),
                f: isPrime(start) ? 1 : 0,
                impulse: 0,
                t: 0
            }];

            let currentN = start;
            let cumulativeT = 0;

            for (let i = 0; i < steps; i++) {
                const delta = findDelta(currentN);
                const nextN = currentN + delta;
                const nextIsPrime = isPrime(nextN);
                const f_curr = isPrime(currentN) ? 1 : 0;
                const f_next = nextIsPrime ? 1 : 0;
                const impulse = f_curr ^ f_next;

                if (nextIsPrime) {
                    cumulativeT += Math.log(nextN);
                }

                sequence.push({
                    n: nextN,
                    delta: delta,
                    isPrime: nextIsPrime,
                    f: f_next,
                    impulse: impulse,
                    t: cumulativeT
                });

                currentN = nextN;
            }

            return sequence;
        }

        function drawBoolean(sequence) {
            const canvas = document.getElementById('booleanCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const steps = document.getElementById('booleanSteps');
            steps.innerHTML = sequence.slice(0, 10).map((s, i) => `
                <div class="delta-step">
                    <span style="color: #60a5fa; font-weight: bold;">n=${s.n}</span>
                    ${s.delta > 0 ? `
                        <span style="color: #94a3b8;">‚Üí Œî=${s.delta} ‚Üí</span>
                        <span style="color: ${s.isPrime ? '#a78bfa' : '#64748b'};">
                            ${s.n}
                        </span>
                    ` : ''}
                    ${s.isPrime ? '<span class="prime-marker">PRIM</span>' : ''}
                    ${s.impulse === 1 ? '<span class="impulse">Œ¥=1</span>' : ''}
                </div>
            `).join('');

            // Impulsdiagramm
            const w = canvas.width;
            const h = canvas.height;
            const barWidth = w / sequence.length;

            ctx.strokeStyle = 'rgba(96, 165, 250, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, h / 2);
            ctx.lineTo(w, h / 2);
            ctx.stroke();

            sequence.forEach((s, i) => {
                const x = i * barWidth;
                const y = h / 2 - (s.f * h / 3);
                
                if (s.f === 1) {
                    ctx.fillStyle = 'rgba(167, 139, 250, 0.6)';
                    ctx.fillRect(x, y, barWidth - 2, h / 3);
                }

                if (s.impulse === 1) {
                    ctx.strokeStyle = '#fb923c';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(x + barWidth / 2, h / 4);
                    ctx.lineTo(x + barWidth / 2, 3 * h / 4);
                    ctx.stroke();
                }
            });
        }

        function drawHelix(sequence) {
            const canvas = document.getElementById('helixCanvas');
            const ctx = canvas.getContext('2d');
            const r = parseFloat(document.getElementById('radius').value);
            const omega = parseFloat(document.getElementById('omega').value);
            const kappa = 0.3;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            const primes = sequence.filter(s => s.isPrime);
            const times = primes.map(p => p.t);
            const maxT = times[times.length - 1] || 1;

            // Spirallinie
            const points = [];
            for (let i = 0; i <= 200; i++) {
                const t = (maxT * i) / 200;
                const x = r * Math.cos(omega * t);
                const z = kappa * t;
                const y = r * Math.sin(omega * t);
                
                const proj = project3D(x, y, z, 0.3, rotationY);
                points.push(proj);
            }

            ctx.strokeStyle = 'rgba(96, 165, 250, 0.3)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            points.forEach((p, i) => {
                if (i === 0) ctx.moveTo(centerX + p.x, centerY + p.y);
                else ctx.lineTo(centerX + p.x, centerY + p.y);
            });
            ctx.stroke();

            // Primzahl-Punkte
            primes.forEach((p, i) => {
                const t = p.t;
                const x = r * Math.cos(omega * t);
                const z = kappa * t;
                const y = r * Math.sin(omega * t);
                const proj = project3D(x, y, z, 0.3, rotationY);

                const size = 8;
                ctx.fillStyle = 'rgba(167, 139, 250, 0.8)';
                ctx.beginPath();
                ctx.arc(centerX + proj.x, centerY + proj.y, size, 0, Math.PI * 2);
                ctx.fill();

                if (i < 5) {
                    ctx.fillStyle = '#e2e8f0';
                    ctx.font = '11px monospace';
                    ctx.fillText(p.n, centerX + proj.x + 12, centerY + proj.y);
                }
            });

            // Stats
            const stats = document.getElementById('geometricStats');
            const angle = Math.atan((omega * r) / kappa) * (180 / Math.PI);
            stats.innerHTML = `
                <div class="stat-box">
                    <div class="stat-label">Primzeit</div>
                    <div class="stat-value">${maxT.toFixed(2)}</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Winkel œÜ</div>
                    <div class="stat-value">${angle.toFixed(1)}¬∞</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Primzahlen</div>
                    <div class="stat-value">${primes.length}</div>
                </div>
            `;
        }

        function project3D(x, y, z, rotX, rotY) {
            const cosY = Math.cos(rotY);
            const sinY = Math.sin(rotY);
            const x1 = x * cosY - z * sinY;
            const z1 = x * sinY + z * cosY;
            
            const cosX = Math.cos(rotX);
            const sinX = Math.sin(rotX);
            const y1 = y * cosX - z1 * sinX;
            const z2 = y * sinX + z1 * cosX;
            
            const scale = 400 / (z2 + 15);
            return { x: x1 * scale, y: y1 * scale, z: z2 };
        }

        function calculate() {
            const start = parseInt(document.getElementById('startN').value);
            const steps = parseInt(document.getElementById('steps').value);
            const sequence = calculateSequence(start, steps);

            drawBoolean(sequence);
            drawHelix(sequence);

            const output = document.getElementById('sequenceOutput');
            const primes = sequence.filter(s => s.isPrime);
            output.innerHTML = `
                <div class="formula-box">
                    <strong>Œî-Pfad:</strong> ${sequence.map(s => s.n).join(' ‚Üí ')}<br><br>
                    <strong>Primzahlen:</strong> ${primes.map(p => p.n).join(', ')}<br><br>
                    <strong>Primzeiten t‚Çñ:</strong> ${primes.map(p => p.t.toFixed(2)).join(', ')}
                </div>
            `;
        }

        function startAnimation() {
            let isAnimating = true;
            function animate() {
                if (isAnimating) {
                    rotationY += 0.02;
                    const start = parseInt(document.getElementById('startN').value);
                    const steps = parseInt(document.getElementById('steps').value);
                    const sequence = calculateSequence(start, steps);
                    drawHelix(sequence);
                    requestAnimationFrame(animate);
                }
            }
            animate();
            setTimeout(() => { isAnimating = false; }, 5000);
        }

        // Initial
        calculate();
    </script>
</body>
</html>